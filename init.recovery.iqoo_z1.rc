# iQOO Z1 (PD1986) TWRP 触控修复脚本 - 实际路径版
# 目标：强制唤醒系统、点亮屏幕、阻止触控休眠

# 1. 初始化阶段：强制禁用系统深度休眠
on init
    # 强制禁用内核深度休眠
    write /sys/power/autosleep off
    write /sys/power/state "on"
    # 申请永久唤醒锁
    write /sys/power/wake_lock "twrp_touch_fix"

# 2. 文件系统就绪后：挂载vendor分区
on post-fs
    wait /dev/block/by-name/vendor
    mount ext4 /dev/block/by-name/vendor /vendor ro wait rec

# 3. TWRP启动完成后：强制唤醒所有设备
on property:sys.boot_completed=1
    # 3.1 强制点亮屏幕（实际路径）
    write /sys/devices/platform/14116000.dispsys_config/graphics/fb0/blank 0

    # 3.2 强制点亮背光（MTK实际路径，两个都操作）
    write /sys/class/leds/lcd-backlight/brightness 2047
    write /sys/class/leds/lm3697-backlight/brightness 2047

    # 3.3 修复触控设备节点权限
    chmod 0666 /dev/input/event3
    chmod 0666 /dev/input/event4
